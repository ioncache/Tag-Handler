(function(c){var r={getSerializedTags:function(){return f(this,"tags").assignedTags.join(",")},getTags:function(){return f(this,"tags").assignedTags.slice()},getSerializedOptions:function(){var a=f(this,"tags");return a.availableTags.concat(a.assignedTags).join(",")},getOptions:function(){var a=f(this,"tags");return a.availableTags.concat(a.assignedTags)},addTag:function(a,b){if(!a)return null;var d=f(this,"opts");if(!d)return null;var e=f(this,"tags");if(!v(this,c.trim(a),b))return e;if(0<d.maxTags&&
    e.assignedTags.length>=d.maxTags)return alert(d.msgMaxTags+" "+d.maxTags),e;var g=1;"function"!=typeof d.onAdd||b||(g=d.onAdd.call(this,a));if("undefined"!=typeof g&&!1===g)return e;e.assignedTags.push(a);e.availableTags=c(this).tagHandler("removeOption",a);q(c(this),a);d.sortTags&&(e=m(e));l(d)&&c(this).find(".tagInputField").autocomplete("option","source",e.availableTags);k(this,"tags",e);""!==d.updateURL&&d.autoUpdate&&!b&&c(this).tagHandler("saveTags");"function"!=typeof d.afterAdd||b||d.afterAdd.call(this,
    a);0<d.maxTags&&e.assignedTags.length>=d.maxTags&&c(this).find(".tagInputField").hide();c(this).tagHandler("refresh");return e},removeTag:function(a){var b=f(this,"opts");if(!b)return null;var d=f(this,"tags"),e=c(this).find(".tagInputField");c(this).find('[data-tag="'+a+'"]').remove();c.each(d.assignedTags,function(b,c){c===a&&d.assignedTags.splice(b,1)});c(this).tagHandler("addOption",a);b.sortTags&&(d=m(d));l(b)&&c(this).find(".tagInputField").autocomplete("option","source",d.availableTags);k(this,
    "tags",d);0<b.maxTags&&d.assignedTags.length<b.maxTags&&e.show();return d},addOption:function(a){var b=f(this,"opts");if(!b)return null;var d=f(this,"tags"),e;e=c.trim(a);if(f(this,"opts")){var g=f(this,"tags");e=n(e,g,"assignedTags")||n(e,g,"availableTags")?!1:!0}else e=!1;if(!e)return d.availableTags;d.availableTags.push(a);b.sortTags&&(d=m(d));l(b)&&c(this).find(".tagInputField").autocomplete("option","source",d.availableTags);k(this,"tags",d);return d.availableTags},removeOption:function(a){var b=
    f(this,"opts");if(!b)return null;var d=f(this,"tags");c.each(d.availableTags,function(b,c){c===a&&d.availableTags.splice(b,1)});l(b)&&c(this).find(".tagInputField").autocomplete("option","source",d.availableTags);k(this,"tags",d);return d.availableTags},saveTags:function(){var a=f(this,"opts");if(a||a.updateURL){var b=f(this,"generatedId"),d=f(this,"tags"),e=c("#"+b+"_save"),g=c("#"+b+"_loader"),b={tags:d.assignedTags};c.extend(b,a.updateData);c.ajax({type:"POST",url:a.updateURL,cache:!1,data:b,dataType:"json",
    beforeSend:function(){e.length?c(e).fadeOut(200,function(){c(g).fadeIn(200)}):c(g).fadeIn(200)},complete:function(){c(g).fadeOut(200,function(){e.length&&c(e).fadeIn(200)})}})}},destroy:function(){var a=f(this,"original"),b=c(this).parent();c(b).replaceWith(a)},reload:function(){var a=f(this,"opts"),b=f(this,"original");a&&(c(this).tagHandler("destroy"),c(b).tagHandler(a))},refresh:function(){var a=c(this).tagHandler("getTags");f(this,"opts");c(this).find(".tagItem").remove();var b=this;c.each(a,
    function(a,c){q(b,c)})},version:function(){return"2.0.0-alpha"}},C=function(a){var b=c.extend({},s(),a);p(c(this),b);c(this).each(function(){c(this).is("ul")&&(k(this,"original",c(this).get(0).cloneNode(!0)),c(this).find("li").each(function(){b.assignedTags.push(c(this).html());c(this).remove()}),k(this,"opts",b),k(this,"tags",{availableTags:[],originalTags:[],assignedTags:[]}),this.id||(this.id=w()),k(this,"generatedId",this.id),x(this),y(this),z(this),A(this),B(this),"function"==typeof b.afterLoad&&
    !b.getURL&&b.initLoad&&t(this))})},x=function(a){var b=f(a,"opts");a=c(a);a.wrap('<div class="'+b.className+'" />');a.addClass(b.className+"Container");var d=c('<li class="tagInput"></li>');d.append('<input class="tagInputField" type="text" />');b.allowEdit&&a.append(d)},y=function(a){var b=f(a,"opts");""!==b.updateURL&&(b.autoUpdate||c("<div></div>").attr({id:a.id+"_save",title:"Save Tags"}).addClass("tagUpdate").click(function(){c(a).tagHandler("saveTags")}).appendTo(c(a).parent()),c("<div />").attr({id:a.id+
    "_loader",title:"Saving Tags"}).addClass("tagLoader").appendTo(c(a).parent()))},q=function(a,b){var d=c(a).find(".tagInputField"),e=f(a,"opts"),g=c('<li data-tag="'+b+'"></li>');c(g).addClass("tagItem");var h=c("<span>"+b+"</span>");e.jqueryTheme&&(c(g).addClass("ui-menu-item").addClass("ui-widget").addClass("ui-state-default").addClass("ui-button-text-only").addClass("ui-corner-all").addClass("ui-widget-content").addClass("jqueryUiTagItem").removeClass("tagItem"),c(h).addClass("ui-button-text"));
    c(g).append(h);c(g).insertBefore(c(d).parent())},z=function(a){var b=f(a,"opts");if(b&&b.autocomplete&&"function"==typeof c.fn.autocomplete){var d=f(a,"tags"),e=null,e=b.initLoad?d.availableTags:b.getURL?function(a,d){b.initLoad||(b.getData[b.queryname]=a.term);c.ajax({url:b.getURL,cache:!1,data:b.getData,dataType:"json",success:function(a){d(a.availableTags)},error:function(a,c,d){p(a,{text:c,error:d});throw Error(b.msgError);}})}:[],g=c(a).find(".tagInputField");c(g).autocomplete({source:e,select:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     e){var f=c(this),g=c.trim(e.item.value);d=c(a).tagHandler("addTag",g);f.focus();f.val("");return!1},minLength:b.minChars})}},A=function(a){var b=f(a,"opts");b&&(f(a,"tags"),""!==b.getURL&&b.initLoad?c.ajax({url:b.getURL,cache:!1,data:b.getData,dataType:"json",success:function(b){u(a,b);t(a)},error:function(a,c,f){p(a,{text:c,error:f});throw Error(b.msgError);}}):u(a,b))},t=function(a){var b=f(a,"opts");b&&"function"==typeof b.afterLoad&&b.afterLoad.call(a)},B=function(a){var b=f(a,"opts");if(b){var d=
    f(a,"tags"),e=c(a).find(".tagInputField");b.allowEdit&&(c(e).keypress(c(a),D),c(e).keydown(c(a),E),c(a).click(function(){c(e).focus();c(e).trigger("focus")}),c(e).focus(function(){""===c(e).val()&&b.autocomplete&&"function"==typeof c.fn.autocomplete&&0<d.availableTags.length&&c(e).autocomplete("search","")}),c(a).delegate("li.tagItem, li.jqueryUiTagItem","click",c(a),F))}},F=function(a){a=a.data;var b=f(a,"opts");if(b){f(a,"tags");var d=c(this),e=1;"function"==typeof b.onDelete&&(e=b.onDelete.call(this,
    c.trim(d.text())));if(e||"undefined"==typeof e)c(a).tagHandler("removeTag",d.text()),""!==b.updateURL&&b.autoUpdate&&c(a).tagHandler("saveTags");"function"==typeof b.afterDelete&&b.afterDelete.call(this,c.trim(d.text()))}},D=function(a){var b=a.data,d=f(b,"opts");if(d){var e=f(b,"tags"),g=a.keyCode||a.which,h=c(this);if(13===g||44===g||9===g||g===d.delimiter.charCodeAt(0))a.preventDefault(),a.stopImmediatePropagation(),d.allowAdd?(0<d.maxTags&&e.assignedTags.length>=d.maxTags?alert(d.msgMaxTags+" "+
    d.maxTags):(a=c.trim(h.val()),c(b).tagHandler("addTag",a)),h.val(""),h.focus()):alert(d.msgNoNewTag)}},E=function(a){var b=a.data,d=f(b,"opts");if(d){var e=f(b,"tags"),g=a.keyCode||a.which,h=c(this);9===g&&(a.preventDefault(),a.stopImmediatePropagation());if(8===a.which&&""===h.val()){a=e.assignedTags.slice(-1)[0];e=1;"function"==typeof d.onDelete&&(e=d.onDelete.call(this,c.trim(a)));if(e||"undefined"==typeof e)c(b).tagHandler("removeTag",a),""!==d.updateURL&&d.autoUpdate&&c(b).tagHandler("saveTags");
    "function"==typeof d.afterDelete&&d.afterDelete.call(this,c.trim(a));h.focus()}}},u=function(a,b){c(b.availableTags).each(function(b,e){c(a).tagHandler("addOption",e)});c(b.assignedTags).each(function(b,e){c(a).tagHandler("addTag",e,!0)})},v=function(a,b,c){var e=f(a,"opts");if(!e)return!1;a=f(a,"tags");if(n(b,a,"assignedTags"))return!1;a=!0;"function"!=typeof e.onIsValid||c||(a=e.onIsValid.call(this,b));return a},n=function(a,b,c){var e=!1;jQuery.each(b[c],function(b,c){return c===a?(e=!0,!1):!0});
    return e},m=function(a){a.availableTags=a.availableTags.sort();a.assignedTags=a.assignedTags.sort();a.originalTags=a.originalTags.sort();return a},k=function(a,b,d){var e=c(a).data("tagHandlerState");e||(e={});e[b]=d;c(a).data("tagHandlerState",e)},f=function(a,b){var d=c(a).data("tagHandlerState");return d&&void 0!=d[b]?d[b]:null},l=function(a){return a.autocomplete&&"function"==typeof c.fn.autocomplete&&a.allowEdit&&a.initLoad?!0:!1},s=function(){return{allowEdit:!0,allowAdd:!0,assignedTags:[],
    autocomplete:!1,autoUpdate:!1,availableTags:[],className:"tagHandler",debug:!1,delimiter:"",getData:{},getURL:"",initLoad:!0,maxTags:0,minChars:0,msgNoNewTag:"You don't have permission to create a new tag.",msgError:"There was an error getting the tag list.",msgMaxTags:"Maximum tags allowed:",onAdd:{},onDelete:{},onIsValid:{},afterAdd:{},afterDelete:{},queryname:"q",sortTags:!0,updateData:{},updateURL:"",jqueryTheme:!1}},p=function(a,b){b.debug&&window.console&&window.console.log&&(window.console.log(a),
    window.console.log(b),window.console.log(s()))},w=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};jQuery.fn.tagHandler=function(a){return"string"==typeof a&&r[a]?r[a].apply(this,Array.prototype.slice.call(arguments,1)):C.apply(this,arguments)}})(jQuery);